<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Inicio - Intranet PPR</title>
  <link rel="icon" type="image/x-icon" href="IMÁGENES/DIF.png" />
  <style>
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      font-family: 'Poppins', Arial, sans-serif;
      background: #f4f6f8;
      color: #222;
      padding-bottom: 60px; /* espacio para el footer fijo */
    }

    .header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding: 3px 24px;
      background: linear-gradient(90deg,#0b4f84,#083b63);
      color:white;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    }

    .logo img { height:56px; }

    .usuario {
      display:flex;
      align-items:center;
      gap:12px;
    }

    .usuario .texto { 
      display:flex; 
      align-items:center;
      gap:12px; 
    }
    .usuario #nombreUsuario { font-weight:600; color:#fff; }

    .logout {
      background: rgba(255,255,255,0.12);
      border: none;
      color: #fff;
      padding:6px 10px;
      border-radius:8px;
      cursor:pointer;
      font-size:0.85rem;
      transition: background 0.3s ease;
    }
    .logout:hover { background: rgba(255,255,255,0.2); }

    .nav { background:#fff; border-bottom:1px solid #e6e9ee; }
    .nav ul { 
      display:flex; 
      list-style:none; 
      gap:6px; 
      padding:6px 20px; 
    }
    .nav a { 
      display:block; 
      padding:10px 16px; 
      color:#0b4f84; 
      text-decoration:none; 
      border-radius:8px; 
      font-weight:600; 
    }
    .nav a.activo, .nav a:hover { background: #e9f2ff; }

    .contenido {
      padding:30px;
      max-width:1100px;
      margin:0 auto;
    }

    .avisos {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      margin-bottom: 30px;
      margin-top: 30px;
    }

    .avisos h2 {
      color: #0b4f84;
      margin-bottom: 12px;
      font-size: 1.2rem;
    }

    .avisos ul {
      list-style: none;
      padding-left: 0;
    }

    .avisos li {
      margin-bottom: 10px;
      font-size: 0.95rem;
      color: #333;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap:24px;
      margin-top:20px;
    }

    .card {
      background:#fff;
      border-radius:12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      padding:20px;
      transition: transform 0.2s ease;
      text-align:center;
    }

    .card:hover {
      transform: translateY(-4px);
    }

    .card h2 {
      font-size:1.2rem;
      margin-bottom:12px;
      color:#0b4f84;
    }

    .card p {
      font-size:0.95rem;
      margin-bottom:16px;
      color:#555;
    }

    .card a {
      display:inline-block;
      padding:8px 16px;
      background:#0b4f84;
      color:#fff;
      text-decoration:none;
      border-radius:8px;
      font-size:0.85rem;
    }

    .card a:hover {
      background:#083b63;
    }

    .footer {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: linear-gradient(90deg, rgba(11, 79, 132, 0.9), rgba(8, 59, 99, 0.9));
      padding: 8px 20px;
      z-index: 100;
    }

    .footer .LogosDonantes {
      max-width: 1100px;
      margin: 0 auto;
      text-align: center;
    }

    .footer .logos {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .footer .logos img {
      height: 28px;
      filter: brightness(0) invert(1); /* mejora visibilidad en fondo oscuro */
    }

    .footer .logos p {
      font-size: 0.85rem;
      color: #fff;
      margin: 0;
    }
  </style>

  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <header class="header">
    <div class="logo">
      <img src="IMÁGENES/OSC.png" alt="Logo OSC" onerror="this.src='IMÁGENES/default.png'">
    </div>

    <div class="usuario" id="usuarioHeader">
      <div class="texto">
        <span id="nombreUsuario">Usuario</span>
        <button id="btnLogout" class="logout" aria-label="Cerrar sesión">Cerrar sesión</button>
      </div>
    </div>
  </header>

  <nav class="nav">
    <ul>
      <li><a href="inicio.html" class="activo">Inicio</a></li>
      <li id="menuVinculacion" style="display:none;"><a href="vinculacion.html">Vinculación</a></li>
      <li id="menuDashboard" style="display:none;"><a href="dashboard.html">Seguimiento</a></li>
    </ul>
  </nav>

  <main class="contenido">
    <h1 id="saludo">Bienvenido</h1>
    <p>Selecciona una opción para comenzar:</p>

    <div class="avisos">
      <h2>📌 Tablero de Avisos</h2>
      <ul id="listaAvisos">
        <li>Cargando avisos...</li>
      </ul>
    </div>

    <div class="grid">
      <div class="card">
        <h2>Cronograma de Actividades</h2>
        <p>Consulta el calendario de eventos y actividades programadas.</p>
        <a href="calendario.html">Ver calendario</a>
      </div>

      <div class="card">
        <h2>Listas de Asistencia</h2>
        <p>Descarga las listas de asistencia por evento o fecha.</p>
        <a href="asistencias.html">Descargar listas</a>
      </div>

      <div class="card">
        <h2>Subir Incidencias</h2>
        <p>Reporta problemas, observaciones o eventos relevantes.</p>
        <a href="incidencias.html">Subir reporte</a>
      </div>
    </div>
  </main>

  <footer class="footer">
    <section class="LogosDonantes">
      <div class="logos">
        <p>Programa financiado por:</p>
        <img src="IMÁGENES/FECHAC.png" alt="Donantes" />
      </div>
    </section>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const usuario = JSON.parse(localStorage.getItem('usuario'));

      if (!usuario?.nombre || !usuario?.correo) {
        window.location.href = 'index.html';
        return;
      }

      document.getElementById('nombreUsuario').textContent = usuario.nombre;
      document.getElementById('saludo').textContent = `Hola, ${usuario.nombre} 👋`;

      // 👉 Mostrar menús solo si el rol es admin
      if (usuario.rol && usuario.rol.toLowerCase() === "admin") {
        document.getElementById('menuVinculacion').style.display = "list-item";
        document.getElementById('menuDashboard').style.display = "list-item";
      }

      document.getElementById('btnLogout').addEventListener('click', () => {
        if (window.google?.accounts?.id) {
          try {
            window.google.accounts.id.disableAutoSelect();
          } catch (e) { console.warn(e); }
        }

        localStorage.removeItem('usuario');
        window.location.href = 'index.html';
      });

      const sheetURL = 'https://docs.google.com/spreadsheets/d/1kjEK6zGaZn_KkjfCJJ1lGYhvjZubwA3DFcZ10s0wdkg/gviz/tq?tqx=out:json&sheet=AVISOS';

      fetch(sheetURL)
        .then(res => res.text())
        .then(text => {
          const json = JSON.parse(text.substring(47).slice(0, -2));
          const rows = json.table.rows;
          const lista = document.getElementById('listaAvisos');
          lista.innerHTML = '';

          rows.forEach(row => {
            const aviso = row.c[0]?.v;
            if (aviso) {
              const li = document.createElement('li');
              li.textContent = aviso;
              lista.appendChild(li);
            }
          });

          if (lista.children.length === 0) {
            lista.innerHTML = '<li>No hay avisos disponibles.</li>';
          }
        })
        .catch(err => {
          console.error('Error al cargar avisos:', err);
          document.getElementById('listaAvisos').innerHTML = '<li>Error al cargar avisos.</li>';
        });
    });
  </script>
</body>
</html>
